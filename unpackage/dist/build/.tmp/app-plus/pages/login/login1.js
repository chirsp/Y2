(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login1"],{"57b9":function(t,e,i){"use strict";(function(t){i("505a"),i("921b");a(i("66fd"));var e=a(i("93bd"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("6e42")["createPage"])},"698e":function(t,e,i){"use strict";var a,n=function(){var t=this,e=t.$createElement;t._self._c},o=[];i.d(e,"b",function(){return n}),i.d(e,"c",function(){return o}),i.d(e,"a",function(){return a})},"8b42":function(t,e,i){"use strict";var a=i("9193"),n=i.n(a);n.a},"8d56":function(t,e,i){"use strict";(function(t,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i("2f62");function o(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},a=Object.keys(i);"function"===typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),a.forEach(function(e){r(t,e,i[e])})}return t}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var s={data:function(){return{maxMobile:11,mobile:"",pwd:"",isCaptcha:!1,captcha:"",captchaUrl:"",btnb:"btn btn-square btn-c btn-all",weixinBrowser:!1,thirdPartyLogins:["weixin"],type:""}},onLoad:function(e){t.hideShareMenu(),this.weixinBrowser=this.$common.isWeiXinBrowser(),this.weixinBrowser&&this.getAuths(),this.type="app",this.getAppAuths()},onShow:function(){this.$db.get("userToken")&&t.switchTab({url:"/pages/index/index"})},computed:{loginButtonClass:function(){return this.mobile&&11===this.mobile.length&&this.pwd?this.btnb+" btn-b":this.btnb},logoImage:function(){return this.$store.state.shop_logo},getThirdLoginImg:function(t){return function(t){return"Wxofficial"==t?"/static/weixin.png":"weixin"==t?"/static/weixin.png":void 0}}},methods:o({},(0,n.mapMutations)(["login","changeNeedScan"]),{rightMobile:function(){var t={};return this.mobile?/^1[3456789]{1}\d{9}$/gi.test(this.mobile)?this.pwd?t.status=!0:(t.status=!1,t.msg="请输入密码"):(t.status=!1,t.msg="手机号格式不正确"):(t.status=!1,t.msg="请输入手机号"),t},loginHandler:function(){this.mobile&&11===this.mobile.length&&this.pwd&&(this.rightMobile().status?this.toLogin():this.$api.errorToShow(this.rightMobile().msg))},getCaptchaUrl:function(){},toReg:function(){t.redirectTo({url:"/pages/login/register"})},toLogin:function(){var e={mobile:this.mobile,password:this.pwd,shop_id:this.$store.state.shopId,type:this.type};this.isCaptcha&&(e.captcha=this.captcha);var i=this.$api.getStorage("invitecode");i&&(e.invitecode=i);var a=this;a.$api.ajax("smdc/user/login",e,function(e){e.data.id?a.$api.toast("登陆成功","success"):a.$api.toast("未成功登陆，请重试");var i={uid:e.data.id,userInfo:e.data};a.login(i),a.$api.setStorage("kejia_order_uid",e.data.id),a.$api.setStorage("kejia_order_openId",e.data.openid),a.$api.setStorage("kejia_order_userInfo",e.data),a.$api.setStorage("kejia_order_token",e.data.token),t.navigateBack()},"POST")},redirectHandler:function(){this.$api.del("invitecode"),this.handleBack()},selectLoginType:function(){this.$api.openWin("/pages/login/codelogin")},getAuths:function(){},handleThirdLogin:function(t){this.$common.redirectTo("");var e=this.$store.state.redirectPage;this.$db.set("redirectPage",e),window.location.href=t},getUserInfo:function(t){console.log(a(t," at pages\\login\\login1.vue:252"));var e=this,i=t.detail;"getUserInfo:fail auth deny"==i.errMsg?e.$api.toast("为了更好的服务，请同意授权"):"getUserInfo:ok"==i.errMsg?e.userLogin(t.detail):e.$api.toast("授权失败")},userLogin:function(e){var i=this;t.login({success:function(a){var n=a.code;if(n){var o={code:n,signature:e.signature,iv:e.iv,encryptedData:e.encryptedData,rawData:e.rawData,shop_id:i.$store.state.shopId||0,type:i.type};i.$api.ajax("smdc/index/login",o,function(e){if(2==e.code)t.redirectTo({url:"/pages/login/bingphone?wxinfo="+JSON.stringify(e.data)});else{e.data.id?i.$api.toast("登陆成功","success"):i.$api.toast("未成功登陆，请重试");var a={uid:e.data.id,userInfo:e.data};i.login(a),i.$api.setStorage("kejia_order_uid",e.data.id),i.$api.setStorage("kejia_order_openId",e.data.openid),i.$api.setStorage("kejia_order_token",e.data.token),i.$api.setStorage("kejia_order_userInfo",e.data),t.navigateBack()}},"POST",!0)}},fail:function(){i.$api.toast("没有获取到登陆信息，请重试")}})},getAppAuths:function(){var e=this;e.thirdPartyLogins=[],t.getProvider({service:"oauth",success:function(t){"getProvider:ok"==t.errMsg&&(e.thirdPartyLogins=t.provider)}})},handleThirdLoginApp:function(){console.log(a("App微信拉起授权"," at pages\\login\\login1.vue:325")),t.showLoading({title:"正在登录"});var e=this;t.getProvider({service:"oauth",success:function(i){console.log(a(i.provider," at pages\\login\\login1.vue:333")),~i.provider.indexOf("weixin")&&t.login({provider:"weixin",success:function(t){console.log(a("App微信获取用户信息成功",t," at pages\\login\\login1.vue:339")),e.getApploginData(t)},fail:function(t){console.log(a("App微信获取用户信息失败",t," at pages\\login\\login1.vue:343"))}})}})},getApploginData:function(e){var i=this;t.request({url:"https://api.weixin.qq.com/sns/userinfo?access_token="+e.authResult.access_token+"&openid="+e.authResult.openid,method:"GET",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){i.$api.ajax("smdc/index/applogin",{shop_id:i.$store.state.shopId||0,openid:e.data.openid,nickName:e.data.nickname,avatarUrl:e.data.headimgurl},function(e){if(t.hideLoading(),2==e.code)t.showToast({title:"登录成功，前往绑定手机号"}),t.navigateTo({url:"/pages/login/bingphone?wxinfo="+JSON.stringify(e.data)});else{var a={uid:e.data.id,userInfo:e.data};i.login(a),i.$api.setStorage("kejia_order_uid",e.data.id),i.$api.setStorage("kejia_order_openId",e.data.openid),i.$api.setStorage("kejia_order_userInfo",e.data),i.$api.setStorage("kejia_order_token",e.token),t.navigateBack()}},"POST",!1)},fail:function(){}})}})};e.default=s}).call(this,i("6e42")["default"],i("0de9")["default"])},9193:function(t,e,i){},"93bd":function(t,e,i){"use strict";i.r(e);var a=i("698e"),n=i("f86a");for(var o in n)"default"!==o&&function(t){i.d(e,t,function(){return n[t]})}(o);i("8b42");var r,s=i("f0c5"),d=Object(s["a"])(n["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],r);e["default"]=d.exports},f86a:function(t,e,i){"use strict";i.r(e);var a=i("8d56"),n=i.n(a);for(var o in a)"default"!==o&&function(t){i.d(e,t,function(){return a[t]})}(o);e["default"]=n.a}},[["57b9","common/runtime","common/vendor"]]]);