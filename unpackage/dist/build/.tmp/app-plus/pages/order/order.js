(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/order"],{"31df":function(o,t,e){"use strict";e.r(t);var r=e("7abd"),a=e("ceea");for(var n in a)"default"!==n&&function(o){e.d(t,o,function(){return a[o]})}(n);e("9ad0");var i,s=e("f0c5"),d=Object(s["a"])(a["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],i);t["default"]=d.exports},"5ab8":function(o,t,e){"use strict";(function(o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=e("2f62");function n(o){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{},r=Object.keys(e);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(e).filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.forEach(function(t){i(o,t,e[t])})}return o}function i(o,t,e){return t in o?Object.defineProperty(o,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):o[t]=e,o}var s=function(){return e.e("components/coupon").then(e.bind(null,"60f8"))},d={data:function(){return{eatType:0,data:[],orderId:0,orderNo:0,totalMoney:0,totalMoney2:0,bz:"",show_coupon:!1,current:0,couponList:[],couponInfo:"",codeNo:"",formId:0,code_show:!1,payTypeList:[{id:1,name:"微信支付"}],pay_current:0,canwei_price:0,loading:!0}},computed:(0,a.mapState)(["deskId","_buyList","_orderId","_orderNo","_config","hasLogin"]),components:{coupon:s},onLoad:function(){this.getCart()},onShow:function(){this.hasLogin?this.getUserInfo():this.$api.openWin("/pages/login/login1"),console.log(o("[餐位费]",this._config," at pages\\order\\order.vue:194")),0==this.eatType&&this.checkOrder()},methods:n({},(0,a.mapMutations)(["_clearBuyList"]),{getCart:function(){var o=this;o.$api.ajax("smdc/cart/cartList",{shop_id:o.$store.state.shopId,deskid:o.$store.state.deskId},function(t){o.loading=!1,o.data=t.data.foodlist,o.totalMoney=parseFloat(t.data.totalMoney),o.canwei_price=(parseFloat(o._config.table_fee)+parseFloat(o._config.season_fee))*o.deskNum})},checkOrder:function(){var o=this;o.$api.ajax("smdc/desk/getDetail",{shop_id:o.$store.state.shopId,no:o.$store.state.deskId},function(t){t.data.order_id?(o.orderId=t.data.order_id,o.orderNo=t.data.order_no):o.totalMoney=parseFloat(o.totalMoney)+parseFloat(o.canwei_price)},"POST")},addfunction:function(){var t=this,e=this.couponInfo?this.totalMoney2:this.totalMoney;t.$api.ajax("smdc/order/addorder",{shop_id:t.$store.state.shopId,deskid:t.$store.state.deskId,custom:t.$store.state.deskNum,sale_type:t.eatType,total_price:e.toFixed(2),desk_price:t._config.table_fee,couponid:t.couponInfo?t.couponInfo.id:0,foodlist:JSON.stringify(t.data),coupon_price:t.couponInfo?t.couponInfo.coupon_price:0,bz:t.bz,codeNo:t.codeNo,formid:t.formId},function(e){console.log(o(e.data.order_no," at pages\\order\\order.vue:250"));var a=e.data.order_no,n=e.data.order_id;t.orderNo=a,t.orderId=n,t.clearBuyCar(),t.$api.toast("提交成功","success"),t.$store.commit("_setOrderId",{orderId:t.orderId,orderNo:t.orderNo}),r.redirectTo({url:"../order-details/order-details?orderId="+t.orderId+"&type=1"})},"POST")},getCoupon:function(){var o=this;this.$api.ajax("smdc/coupon/usercounpon",{shop_id:this.$store.state.shopId,type:0,limit:1e3,page:1},function(t){var e=t.data.coupon_mine;if(e.length)for(var r=0,a=e.length;r<a;r++)e[r].status&&parseFloat(o.totalMoney)>=parseFloat(e[r].low_cash_price)&&o.couponList.push(e[r])})},submitOrder:function(){this.hideCode(),this.addOrder()},addOrder:function(){var o=this;this.$api.trim(o.codeNo).length<3?this.$api.alert("请先联系服务员取订餐验证码~","亲爱的客官"):o.addfunction()},addOrder2:function(){var o=this;o.$api.ajax("smdc/order/addOrderFood",{shop_id:o.$store.state.shopId,order_no:o.orderNo,sale_type:o.eatType,total_price:o.totalMoney,foodlist:JSON.stringify(o.data),formid:o.formId},function(t){o.clearBuyCar(),r.redirectTo({url:"../order-details/order-details?orderId="+o.orderId+"&type=1"})},"POST")},pay:function(){1==this.payTypeList[this.pay_current].id?this.pay_wx():2==this.payTypeList[this.pay_current].id?this.pay_balance():this.$api.toast("支付方式异常")},pay_balance:function(){var o=this;o.$api.ajax("smdc/order/yuprice",{order_no:o.orderNo,shop_id:o.$store.state.shopId,formid:o.formId},function(t){o.$api.toast("支付成功","success"),o.$api.openWin("../pay-success/pay-success?orderId="+o.orderId+"&orderNo="+o.orderNo)},"POST")},pay_wx:function(){var t=this;t.$api.ajax("smdc/order/wxpay",{out_trade_no:t.orderNo,shop_id:t.$store.state.shopId,formid:t.formId},function(e){r.requestPayment({provider:"wxpay",timeStamp:e.data.timeStamp,nonceStr:e.data.nonceStr,package:e.data.package,signType:"MD5",paySign:e.data.paySign,success:function(e){console.log(o("success:"+JSON.stringify(e)," at pages\\order\\order.vue:374")),t.$api.toast("支付成功","success"),t.$api.openWin("../pay-success/pay-success?orderId="+t.orderId)},fail:function(e){console.log(o("fail:"+JSON.stringify(e)," at pages\\order\\order.vue:379")),t.$api.alert("未支付","友情提示")}})},"POST")},changeType:function(o){this.eatType=o},showCoupon:function(){this.couponList.length&&(this.show_coupon=!0)},hideCoupon:function(){this.show_coupon=!1},selectCoupon:function(o){this.current=o},useCoupon:function(o){if(o){this.couponInfo=this.couponList[this.current];var t=parseFloat(this.totalMoney)-parseFloat(this.couponList[this.current].coupon_price);this.totalMoney2=parseFloat(t).toFixed(2),2==this.payTypeList[this.pay_current].id&&(this.pay_current=0,this.$api.toast("优惠券不能和余额支付同时使用","none","2000"))}else this.couponInfo="";this.hideCoupon()},showCode:function(t){var e=t.detail.formId;this.formId=e,console.log(o("[this._orderId]",this.orderId,this.orderNo," at pages\\order\\order.vue:423")),this.addfunction()},isPay:function(){var o=this;o.$api.ajax("smdc/order/ordernoStatus",{shop_id:o.$store.state.shopId,deskid:o.$store.state.deskId},function(t){var e=t.data.status;1==e?(o.orderId=t.data.order_id,o.orderNo=t.data.order_no,o.addOrder2()):o.addfunction()},"POST")},clearBuyCar:function(){var o=this;o.$api.ajax("smdc/cart/clearAll",{shop_id:o.$store.state.shopId,deskid:o.$store.state.deskId},function(o){})},hideCode:function(){this.code_show=!1},selectPayType:function(t){console.log(o(t," at pages\\order\\order.vue:464")),this.pay_current=t.detail.value,2==this.payTypeList[t.detail.value].id&&this.couponInfo&&(this.couponInfo="",this.$api.toast("优惠券不能和余额支付同时使用","none","2000"))}})};t.default=d}).call(this,e("0de9")["default"],e("6e42")["default"])},"7abd":function(o,t,e){"use strict";var r,a=function(){var o=this,t=o.$createElement,e=(o._self._c,parseFloat(o._config.table_fee)),r=parseFloat(o._config.season_fee);o.$mp.data=Object.assign({},{$root:{m0:e,m1:r}})},n=[];e.d(t,"b",function(){return a}),e.d(t,"c",function(){return n}),e.d(t,"a",function(){return r})},8656:function(o,t,e){"use strict";(function(o){e("505a"),e("921b");r(e("66fd"));var t=r(e("31df"));function r(o){return o&&o.__esModule?o:{default:o}}o(t.default)}).call(this,e("6e42")["createPage"])},"9ad0":function(o,t,e){"use strict";var r=e("dfb6"),a=e.n(r);a.a},ceea:function(o,t,e){"use strict";e.r(t);var r=e("5ab8"),a=e.n(r);for(var n in r)"default"!==n&&function(o){e.d(t,o,function(){return r[o]})}(n);t["default"]=a.a},dfb6:function(o,t,e){}},[["8656","common/runtime","common/vendor"]]]);