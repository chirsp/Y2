(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order-details/order-details"],{"127f":function(t,e,o){"use strict";var a,r=function(){var t=this,e=t.$createElement,o=(t._self._c,t.$api.format(t.data.create_time)),a=(parseFloat(t.data.coupon_price)+parseFloat(t.data.total_price)).toFixed(2),r=t.$api.format(t.data.create_time),n=(parseFloat(t.data.coupon_price)+parseFloat(t.data.total_price)).toFixed(2);t.$mp.data=Object.assign({},{$root:{g0:o,g1:a,g2:r,g3:n}})},n=[];o.d(e,"b",function(){return r}),o.d(e,"c",function(){return n}),o.d(e,"a",function(){return a})},"263d":function(t,e,o){"use strict";o.r(e);var a=o("127f"),r=o("4499");for(var n in r)"default"!==n&&function(t){o.d(e,t,function(){return r[t]})}(n);o("f514");var s,i=o("f0c5"),d=Object(i["a"])(r["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],s);e["default"]=d.exports},4499:function(t,e,o){"use strict";o.r(e);var a=o("7e9e"),r=o.n(a);for(var n in a)"default"!==n&&function(t){o.d(e,t,function(){return a[t]})}(n);e["default"]=r.a},"4b47":function(t,e,o){"use strict";(function(t){o("505a"),o("921b");a(o("66fd"));var e=a(o("263d"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("6e42")["createPage"])},"7e9e":function(t,e,o){"use strict";(function(t,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;o("2f62");var r=function(){return o.e("components/coupon").then(o.bind(null,"60f8"))},n=function(){return o.e("components/uni-countdown").then(o.bind(null,"b37d"))},s={data:function(){return{orderId:0,alreadyOId:"",data:"",isNoPay:!1,isLoad:!1,show_coupon:!1,couponList:[],couponInfo:"",totalMoney2:0,current:0,payTypeList:[{id:1,name:"微信支付"},{id:2,name:"余额支付"}],pay_current:0,formId:"",minute:0,second:"1",hour:"0",reset:!1,dishStatus:"",type:"",_config:""}},components:{coupon:r,uniCountdown:n},onPullDownRefresh:function(){this.getData()},onLoad:function(t){this._config=this.$store.state._config,t.orderId&&(this.orderId=t.orderId,this.type=t.type,this.getdishStatus(),this.getData()),t.alreadyOId&&(this.alreadyOId=t.alreadyOId)},methods:{getdishStatus:function(){var t=this;t.$api.ajax("smdc/food_process/FoodProcessList",{shop_id:t.$store.state.shopId},function(e){t.dishStatus=e.data},"POST")},returnFood:function(e,o){var a=this;if(1==e.is_finish||1==e.is_delivery)var r="smdc/order_Refund/add";else r="smdc/order/orderRefund";a.$api.ajax(r,{shop_id:a.$store.state.shopId,order_id:a.orderId,type:o,sale_food_id:e.id,deskid:a.$store.state.deskId,money:e.net_pay},function(e){0==e.status?t.showModal({title:"系统提示",content:e.msg,success:function(t){t.confirm?a.getData():t.cancel&&a.getData()}}):a.getData()},"POST",!0)},timeUp:function(){var t=this;t.$api.ajax("smdc/order/cancelOrder",{shop_id:t.$store.state.shopId,id:this.orderId},function(e){t.$api.toast("订单已取消","success"),setTimeout(function(){t.$store.commit("_clearOrderId"),t.getData()},1e3)},"POST")},getCoupon:function(){var t=this;this.$api.ajax("smdc/coupon/usercounpon",{shop_id:this.$store.state.shopId,type:0,limit:1e3,page:1},function(e){t.couponList=[];var o=e.data.coupon_mine;if(o.length)for(var a=0,r=o.length;a<r;a++)o[a].status&&parseFloat(t.data.total_price)>=parseFloat(o[a].low_cash_price)&&t.couponList.push(o[a])})},getData:function(){var e=this;e.$api.ajax("smdc/order/get_order_detail",{order_id:e.orderId,shop_id:this.$store.state.shopId},function(o){setTimeout(function(){t.stopPullDownRefresh()},2e3);var a=o.data;a.food.map(function(t){return"0.00"==t.sale_price?t.pricex=(parseInt(t.num)*parseFloat(t.price)).toFixed(2):t.pricex=(parseInt(t.num)*parseFloat(t.sale_price)).toFixed(2)}),e.data=a,0==o.data.status&&e.getCoupon();var r=Date.parse(new Date),n=e.$store.state.cancle_time,s=60*n*1e3,i=1e3*e.data.create_time,d=r,c=new Date(i+s),u=c-d;if(u>s);else{var p=Math.floor(u/864e5),f=u%864e5,l=Math.floor(f/36e5),h=f%36e5,_=Math.floor(h/6e4),m=Math.floor(h/1e3%60);p<=0&&l<=0&&_<=0&&m<=0||(e.hour=24*p+l,e.minute=_,e.second=m)}},"POST",!0)},setCoupon:function(t){if(t.detail.formId&&(this.formId=t.detail.formId),this.couponInfo){var e=this;e.$api.ajax("smdc/order/set_order_info",{shop_id:e.$store.state.shopId,order_no:e.data.order_no,total_price:e.totalMoney2,couponid:e.couponInfo?e.couponInfo.id:0,coupon_price:e.couponInfo?e.couponInfo.coupon_price:0},function(t){e.pay()},"POST")}else this.pay()},pay:function(){1==this.payTypeList[this.pay_current].id?this.pay_wx():2==this.payTypeList[this.pay_current].id?this.pay_balance():this.$api.toast("支付方式异常")},pay_balance:function(){var e=this;console.log(a("余额支付"," at pages\\order-details\\order-details.vue:480")),e.$api.ajax("smdc/order/yuprice",{order_no:e.data.order_no,shop_id:e.$store.state.shopId,formid:this.formId},function(o){e.$api.toast("支付成功","success"),e.$store.commit("_clearOrderId"),setTimeout(function(){t.reLaunch({url:"/pages/my-orders/my-orders"})},1e3)},"POST")},pay_wx:function(){var t=this,e="smdc/order/apppay";t.$api.ajax(e,{out_trade_no:t.data.order_no,shop_id:t.$store.state.shopId,formid:t.formId},function(e){console.log(a("【支付接口回调】",e," at pages\\order-details\\order-details.vue:513")),t.$api.wxPay(e.data,"/pages/my-orders/my-orders")},"POST")},goMenu:function(){this.$store.commit("_setOrderId",{orderId:this.data.id,orderNo:this.data.order_no}),t.reLaunch({url:"/pages/menu/menu"})},closeOrder:function(){this.$api.tempToast()},showCoupon:function(){this.couponList.length&&(this.show_coupon=!0)},hideCoupon:function(){this.show_coupon=!1},selectCoupon:function(t){console.log(a(t," at pages\\order-details\\order-details.vue:538")),this.current=t},useCoupon:function(t){if(t){this.couponInfo=this.couponList[this.current];var e=parseFloat(this.data.total_price)-parseFloat(this.couponList[this.current].coupon_price);this.totalMoney2=parseFloat(e).toFixed(2)}else this.couponInfo="";this.hideCoupon()},selectPayType:function(t){console.log(a(t," at pages\\order-details\\order-details.vue:557")),this.pay_current=t.detail.value},getPrice:function(t,e,o){var a="0.00"==t?parseInt(o)*parseFloat(e):parseInt(o)*parseFloat(t);return a},evalOrder:function(){t.navigateTo({url:"/pages/my-orders/evalOrder?id="+this.orderId})}}};e.default=s}).call(this,o("6e42")["default"],o("0de9")["default"])},bf84:function(t,e,o){},f514:function(t,e,o){"use strict";var a=o("bf84"),r=o.n(a);r.a}},[["4b47","common/runtime","common/vendor"]]]);